function jitterX(){return(Math.random()-.5)*width/10}function jitterY(){return(Math.random()-.5)*(height/3-(2*person_radius+2*text_height))}var width=1400,height=1050,linkDistance=90,charge=-10,person_radius=100,text_height=18,text_translate_factor=1/linkDistance*10,include_links=!1,reset_timeout=3e3,debug=!1,color=function(a){var b=["#FF1E20","#47A1E8","#FFE700","#41A80B","#FF5E01","#A80278","#55E81D","#999999","#011BA8"].map(function(a){return d3.rgb(a).brighter(.5)});return console.log(b),b[a]};d3.json("plan.json",function(a,b){function c(){function a(){b.attr("transform","translate(0,"+height+")").transition().delay(500).duration(function(){return 500+1500*Math.random()}).attr("transform","translate(0,0)").transition().delay(13e3).duration(function(){return 500+1500*Math.random()}).attr("transform","translate(0,-height)")}var b=k.selectAll(".node").data(g).enter().append("g").attr("class",l),c=b.append("g").attr("transform",function(a){return j(a.x,a.y)}).attr("class","table");c.append("use").attr("class",l).attr("xlink:href","#baloon").attr("transform",function(){return"scale(0.15) translate(-160,-240)"}).style("fill",function(a){return color(a.group)}),c.append("line").attr("x1",0).attr("x2",0).attr("y1",i(45)).attr("y2",i(height)).attr("class","tie").attr("stroke-width",4);var d=c.append("g"),e=d.selectAll("person").data(function(a){return a.children}).enter().append("g").attr("class","person").attr("transform",function(a){return j(person_radius*a.ux,person_radius*a.uy)});debug&&(c.append("circle").attr("cx","0").attr("cy","0").attr("r","10").attr("style","fill: red"),e.append("circle").attr("cx","0").attr("cy","0").attr("r","10").attr("style","fill: red"));var f=e.append("g").attr("class","text"),h=(f.append("text").text(function(a){return firstname(a.name)}),f.append("text").attr("class","surname").attr("transform",j(0,text_height)).text(function(a){return surname(a.name)}));h.each(function(a){var b=this.getBBox();this.parentElement.setAttribute("transform","translate("+(a.ux>0?0:-b.width/2)+",0)")}),setTimeout(a,2e4),a()}function d(a){console.log("zoomToTable",arguments),setTimeout(e,reset_timeout);var b=g[a].x,c=g[a].y,d=2.5;b+=jitterX(),c+=jitterY(),k.transition().duration(750).attr("transform","translate("+width/2+","+height/2+")scale("+d+")translate("+-b+","+-c+")")}function e(){k.transition().duration(750).attr("transform","translate(0,0)scale(1,1)")}function f(a){var c=b.find(function(b){return b.members.indexOf(a)>=0});return d(b.indexOf(c),c)}var g=[];b.forEach(function(a,b){var c=width/6+b%3*width/3,d=height/6+Math.floor(b/3)*height/3,e=2*Math.random()*Math.PI/16;c+=jitterX(),d+=jitterY();{var f=parseInt(a.table.substr(0,1))-1;g.push({name:"",group:f,cls:"table",fixed:!0,x:c,y:d,children:a.members.map(function(a,b,c){var d=b/c.length*2*Math.PI+e;return{name:a,cls:"person",angle:d,ux:Math.cos(d),uy:Math.sin(d)}})})-1}});var h=d3.scale.linear().domain([0,width]).range([0,width]),i=d3.scale.linear().domain([0,height]).range([0,height]),j=function(a,b){return"translate("+h(a)+","+i(b)+")"},k=d3.select("svg").attr("width",width).attr("height",height).append("g"),l=function(a){return"node "+a.cls},m=0;d3.timer(function(){c(++m%100)}),c(0);var n=io.connect("http://localhost:3000/");n.on("zoom",function(a){f(a)})});