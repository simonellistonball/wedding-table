function drawTable(a,b,c,d,e){var f=d3.layout.force().charge(charge).linkDistance(linkDistance).size([width/3,height/3]).gravity(0);f.nodes(b.nodes).links(b.links).start();{var g=function(a){return"node "+a.cls},h=a.selectAll(".atable"+c).data(b.nodes.filter(function(a){return"table"==a.cls})).enter().append("g").attr("class","atable"+c).attr("transform","translate("+d+","+e+")");b.nodes.filter(function(a){return"table"==a.cls})}if(include_links)var i=h.selectAll(".link").data(b.links).enter().append("line").attr("class","link").style("stroke-width","4");var j=h.selectAll(".node").data(b.nodes).enter().append("g").attr("class",g);j.append("use").attr("class",g).attr("xlink:href",function(a){return"table"==a.cls?"#baloon":"#person"}).attr("transform",function(a){return"table"==a.cls?"scale(0.15) translate(0,-200)":"scale("+person_radius+")"}).style("fill",function(a){return color(a.group)}).call(f.drag);var k=j.append("g").attr("class","text");k.append("text").attr("transform","translate(8, 0)").text(function(a){return firstname(a.name)}),k.append("text").attr("class","surname").attr("transform","translate(8, "+text_height+")").text(function(a){return surname(a.name)}),f.on("tick",function(){include_links&&i.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),j.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),k.attr("transform",function(a){if(a.cls==h)return"translate(0,0)";var b=text_translate_factor*(a.x-width/6),c=text_translate_factor*(a.y-height/6);return"translate("+b+","+c+")"})})}var width=1280,height=800,table_radius=40,person_radius=10,linkDistance=90,charge=-300,text_height=20,text_translate_factor=1/linkDistance*10,include_links=!1,reset_timeout=4e3,color=function(a){var b=["#FF1E20","#47A1E8","#FFE700","#41A80B","#FF5E01","#A80278","#55E81D","#999999","#011BA8"];return b[a]},random=d3.random.normal(0,100);d3.json("plan.json",function(a,b){function c(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function d(){}function e(){console.log("zoomToTable",arguments),k.domain([0,width/6]).range([0,width/6]),l.domain([0,height/6]).range([0,height/6]),setTimeout(f,reset_timeout)}function f(){k.domain([0,width]).range([0,width]),l.domain([0,height]).range([0,height])}function g(a){var c=b.find(function(b){return b.members.indexOf(a)>=0});return e(b.indexOf(c),c)}for(var h=0,i=[],j=0;9>j;j++)i.push([j%3*width/3,Math.floor(j/3)*height/3]);c(i,0,4),c(i,6,8),i=i.map(function(a){return[a[0]+random()/3,a[1]+random()/60]});var k=d3.scale.linear().domain([0,width]).range([0,width]),l=d3.scale.linear().domain([0,height]).range([0,height]),m=d3.behavior.zoom().x(k).y(l).size([width,height]).on("zoom",d),n=d3.select("svg").attr("width",width).attr("height",height).call(m);b.forEach(function(a,b){var c={nodes:[],links:[]},d=c.nodes.push({name:"",group:b,cls:"table",fixed:!0,x:width/6,y:height/6})-1;a.members.forEach(function(a){var e=c.nodes.push({name:a,group:b,cls:"person"})-1;c.links.push({source:e,target:d,value:10})});var e=i[h++%i.length];drawTable(n,c,b,k(e[0]),l(e[1]))}),n.call(m.event);var o=io.connect("http://localhost:3000/");o.on("zoom",function(a){g(a)})});